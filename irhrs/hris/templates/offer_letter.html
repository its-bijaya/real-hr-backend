{% extends 'email_base.html' %}

{% block message %}
<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons"
      rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css"
      rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>

<div id="logo" class="center">
    <h1 class="teal--text">
        {{ data.org_name }}
    </h1>
    <v-avatar size=30>
        <img src="{{ data.org_logo }}" alt="{{data.org_name}}"
        style="border-radius: 100%"
             width="100" height="100"
        >
    </v-avatar>
</div>
{% if message %}
    <h1 class="teal--text">
        {{ message }}
    </h1>
{% else %}

<div id="letter" style="word-wrap: break-word; width: 795px">
    <h1 class="white teal--text center">
        {{ data.letter_template.title }}
    </h1>
    <h3 class="teal--text">
        Name: {{ data.pre_employment.full_name | title }}
    </h3>
    <h3 class="teal--text">
        Deadline: {{ deadline|date:"g a Y M d"|title}}
    </h3>
    {% autoescape off %}
    {{ data.message }}
    {% endautoescape %}
</div>


<div id="app">
    {% if data.status in 'accepted, declined' %}
    <h3 class="teal--text">
        You have {{data.status|title}} this offer letter.
    </h3>

{% else %}
    <form
            ref="form"
            action=""
            method="post"
    >
        <input type="hidden" name="remarks" ref="remarks">
        <input type="hidden" name="status" ref="status">
        {% csrf_token %}
        <v-layout
                row
                wrap
        >
            <v-flex
                    xs12
            >
                <v-textarea
                        v-model="remarks"
                        placeholder="Remarks"
                ></v-textarea>
            </v-flex>
            <v-flex
                    offset-xs8
            >
                <v-btn
                        color="red white--text"
                        @click="submitFalse"
                >
                    Decline
                </v-btn>
                <v-btn
                        color="green white--text"
                        @click="submitTrue"
                >
                    Accept
                </v-btn>
            </v-flex>
        </v-layout>
    </form>
</div>

{% if errors %}
<div id="errors">
        There were some errors
        <div class="red--text">
            {% for title, error in errors.items %}
            <br>
                {{title}}
            <br>
            {% for err in error %}
                <ul>{{err}}</ul>
                <br>
            {% endfor %}
        </div>
        {% endfor %}
</div>
{% endif %}

<script>
    new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        data: {
            remarks: '',
        },
        methods: {
            submit(status) {
                self = this
                this.$refs.remarks.value = this.remarks
                this.$refs.status.value = status
                this.$refs.form.submit()
            },
            submitTrue() {
                this.submit('accepted')
            },
            submitFalse() {
                this.submit('declined')
            }
        }
    })

    new Vue({
        el: '#errors',
    })

    new Vue({
        el: "#letter"
    })
    new Vue({
        el: "#logo"
    })
</script>

{% endif %}

{% endif %}
{% endblock %}
