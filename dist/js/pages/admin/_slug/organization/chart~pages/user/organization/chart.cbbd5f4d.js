(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/admin/_slug/organization/chart~pages/user/organization/chart","chunk-31f8a6e6"],{"0549":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-row",{staticClass:"mb-3",attrs:{"no-gutters":""}},[e.breadCrumbs?i("v-col",{attrs:{cols:"12"}},[i("v-card",{attrs:{flat:""}},[i("v-breadcrumbs",{staticClass:"text-body-1 pa-2",class:{"text-caption pa-1":e.$vuetify.breakpoint.xs},attrs:{items:e.breadCrumbs},scopedSlots:e._u([{key:"item",fn:function(t){return[i("span",{class:t.item.disabled?"grey--text":"baseColor--text text--accent-2 pointer",domProps:{textContent:e._s(t.item.text)},on:{click:function(i){return e.$router.push(t.item.to)}}})]}}],null,!1,1670153796)},[i("v-icon",{attrs:{slot:"divider"},slot:"divider"},[e._v("mdi-chevron-right")])],1)],1)],1):e._e()],1),i("v-row",{attrs:{"no-gutters":""}},[i("v-col",{attrs:{cols:"12"}},[e._t("default")],2)],1)],1)},s=[],a=i("5530"),r=(i("ac1f"),i("1276"),i("b0c0"),i("2f62")),o={props:{title:{type:String,required:!0},breadCrumbs:{type:Array,default:function(){return[]}}},computed:Object(a["a"])({},Object(r["c"])({getOrganizationName:"organization/getOrganizationName",getSupervisorSwitchedOrganization:"supervisor/getSwitchedOrganization"})),mounted:function(){document.title="".concat(this.title," | RealHRsoft");var e=this.$route.params.slug?"admin-slug-dashboard":"root",t=this.$route.name.split("-"),i=this.getOrganizationName;this.getSupervisorSwitchedOrganization&&"user"===t[0]&&"supervisor"===t[1]&&(i=this.getSupervisorSwitchedOrganization.name),this.breadCrumbs.unshift({text:i,disabled:!1,to:{name:e,params:{slug:this.$route.params.slug}}})}},d=o,l=i("2877"),c=i("6544"),h=i.n(c),g=i("2bc5"),u=i("b0af"),p=i("62ad"),f=i("132d"),v=i("0fd9b"),b=Object(l["a"])(d,n,s,!1,null,null,null);t["default"]=b.exports;h()(b,{VBreadcrumbs:g["a"],VCard:u["a"],VCol:p["a"],VIcon:f["a"],VRow:v["a"]})},"2bc5":function(e,t,i){"use strict";var n=i("5530"),s=(i("a15b"),i("abd3"),i("ade3")),a=i("1c87"),r=i("58df"),o=Object(r["a"])(a["a"]).extend({name:"v-breadcrumbs-item",props:{activeClass:{type:String,default:"v-breadcrumbs__item--disabled"},ripple:{type:[Boolean,Object],default:!1}},computed:{classes:function(){return Object(s["a"])({"v-breadcrumbs__item":!0},this.activeClass,this.disabled)}},render:function(e){var t=this.generateRouteLink(),i=t.tag,s=t.data;return e("li",[e(i,Object(n["a"])(Object(n["a"])({},s),{},{attrs:Object(n["a"])(Object(n["a"])({},s.attrs),{},{"aria-current":this.isActive&&this.isLink?"page":void 0})}),this.$slots.default)])}}),d=i("80d2"),l=Object(d["i"])("v-breadcrumbs__divider","li"),c=i("7560");t["a"]=Object(r["a"])(c["a"]).extend({name:"v-breadcrumbs",props:{divider:{type:String,default:"/"},items:{type:Array,default:function(){return[]}},large:Boolean},computed:{classes:function(){return Object(n["a"])({"v-breadcrumbs--large":this.large},this.themeClasses)}},methods:{genDivider:function(){return this.$createElement(l,this.$slots.divider?this.$slots.divider:this.divider)},genItems:function(){for(var e=[],t=!!this.$scopedSlots.item,i=[],n=0;n<this.items.length;n++){var s=this.items[n];i.push(s.text),t?e.push(this.$scopedSlots.item({item:s})):e.push(this.$createElement(o,{key:i.join("."),props:s},[s.text])),n<this.items.length-1&&e.push(this.genDivider())}return e}},render:function(e){var t=this.$slots.default||this.genItems();return e("ul",{staticClass:"v-breadcrumbs",class:this.classes},t)}})},"51af":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.user?i("v-row",{attrs:{justify:"center",align:"center","no-gutters":""}},[i("v-menu",{attrs:{"close-on-content-click":!1,"nudge-width":150,"open-on-hover":"","offset-overflow":"","offset-y":"",top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[i("v-row",{staticClass:"px-3",attrs:{align:"center"}},[i("v-card",{staticClass:"py-1 text-center",attrs:{elevation:"4",width:"140"}},[i("div",[i("v-badge",{staticClass:"mr-3",attrs:{dot:"",right:"",bottom:"",overlap:"","offset-y":"10",color:e.user.is_online?"green":"red"}},[i("v-icon",{attrs:{slot:"badge",color:"green",size:"12"},slot:"badge"},[e._v(" mdi-circle ")]),i("v-avatar",e._g({attrs:{size:"50"}},n),[i("v-img",{attrs:{src:e.user.profile_picture_thumb||e.user.profile_picture}})],1)],1)],1),i("div",[i("div",{staticClass:"text-caption pointer blue--text",on:{click:function(t){return e.viewProfileDetail(e.user.id)}}},[e._v(" "+e._s(e._f("truncate")(e.user.full_name?e.user.full_name:"",16))+" ")]),i("div",{staticClass:"text-caption"},[e._v(" "+e._s(e._f("truncate")(e.user.organization?e.user.organization.name:"",16))+" ")]),i("div",{staticClass:"text-caption grey--text"},[e._v(" "+e._s(e._f("truncate")(e.user.employee_level?e.user.employee_level:"",16))+" ")]),i("div",{staticClass:"text-caption grey--text"},[e._v(" "+e._s(e._f("truncate")(e.user.job_title?e.user.job_title:"",16))+" ")])])])],1)]}}],null,!1,730079779)},[i("vue-hover-card",{attrs:{user:e.user,clickable:e.clickable}})],1)],1):i("span",{staticClass:"my-3",domProps:{textContent:e._s("N/A")}})},s=[],a=i("5530"),r=i("49bb"),o=i("2f62"),d={components:{VueHoverCard:r["a"]},props:{user:{type:Object,default:null},clickable:{type:Boolean,default:!0}},computed:Object(a["a"])({},Object(o["c"])({getAppView:"common/getAppView"})),methods:{viewProfileDetail:function(e){this.clickable&&("userView"===this.getAppView?this.$router.push({name:"user-employee-directory-id-profile-detail",params:{id:e}}):this.$router.push({name:"admin-slug-hris-users-id",params:{id:e,slug:this.getOrganizationSlug}}))}}},l=d,c=i("2877"),h=i("6544"),g=i.n(h),u=i("8212"),p=i("4ca6"),f=i("b0af"),v=i("132d"),b=i("adda"),m=i("e449"),C=i("0fd9b"),E=Object(c["a"])(l,n,s,!1,null,null,null);t["a"]=E.exports;g()(E,{VAvatar:u["a"],VBadge:p["a"],VCard:f["a"],VIcon:v["a"],VImg:b["a"],VMenu:m["a"],VRow:C["a"]})},6500:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"chart-container"},on:{click:e.registerEdgeClick}})},s=[],a=i("b083"),r=a["a"],o=(i("ae4e"),i("2877")),d=Object(o["a"])(r,n,s,!1,null,null,null);t["a"]=d.exports},"886f":function(e,t,i){},"98f0":function(e,t,i){"use strict";t["a"]={getFamily:function(e){return"/hris/organization-chart/family/user/".concat(e,"/")},getChildren:function(e){return"/hris/organization-chart/children/user/".concat(e,"/")},getSiblings:function(e){return"/hris/organization-chart/siblings/user/".concat(e,"/")},getParent:function(e){return"/hris/organization-chart/parent/user/".concat(e,"/")}}},a822:function(e,t,i){},abd3:function(e,t,i){},ae4e:function(e,t,i){"use strict";i("a822")},b083:function(e,t,i){"use strict";(function(e){var n=i("1da1"),s=(i("7db0"),i("99af"),i("96cf"),i("886f"),i("51af")),a=i("2b0e"),r=i("402c"),o=i("1157"),d=i.n(o),l=i("98f0"),c=i("cf45");i("f3cd");var h=a["a"].extend(s["a"]),g=d.a,u=i("a78e");t["a"]={props:{as:{type:String,default:""}},data:function(){return{ds:{},ajaxURLs:{}}},mounted:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.initAjaxUrl(),t.next=3,e.loadData();case 3:g("#chart-container").orgchart({data:e.ds,ajaxURL:e.ajaxURLs,nodeContent:"title",nodeTemplate:e.nodeTemplate,pan:!0,zoom:!0}),e.registerEdgeClick();case 5:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){g("#chart-container").empty()},methods:{registerEdgeClick:function(){g("#chart-container").find(".edge").on("click",(function(){if(g(event.target).is(".edge.verticalEdge.bottomEdge.fa.fa-chevron-up")||g(event.target).is(".edge.verticalEdge.topEdge.fa.fa-chevron-down")||g(event.target).is(".edge.horizontalEdge.rightEdge.fa.fa-chevron-left")||g(event.target).is(".edge.horizontalEdge.leftEdge.fa.fa-chevron-right")){var e=g(this),t=e.closest(".orgchart");t.css("transform","matrix(1, 0, 0, 1, 0, 0)")}}))},initAjaxUrl:function(){g.ajaxSetup({headers:{Accept:"application/json, text/plain, */*",Authorization:"Bearer ".concat(u.get("auth._token.local"))}});var t="";e.browser&&(t="manualtesting"===Object(c["f"])("VUE_APP_ENV")||"development"===Object(c["f"])("VUE_APP_ENV")?Object(c["f"])("VUE_APP_API_URL"):window.location.origin+"/api/v1"),this.ajaxURLs={children:function(e){return"".concat(t).concat(l["a"].getChildren(e.user.id))},parent:function(e){return"".concat(t).concat(l["a"].getParent(e.user.id))},siblings:function(e){return"".concat(t).concat(l["a"].getSiblings(e.user.id))},families:function(e){return"".concat(t).concat(l["a"].getFamily(e.user.id))}}},loadData:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get(l["a"].getFamily(e.getAuthStateUserId)+"?as=".concat(e.as,"&children=true")).then((function(t){e.ds=t}));case 2:case"end":return t.stop()}}),t)})))()},nodeTemplate:function(e){var t=new h({vuetify:r["a"],propsData:{user:e.user,clickable:!1,parent:this}}),i=t.$mount();return i.$el}}}}).call(this,i("4362"))},f3cd:function(e,t,i){"use strict";(function(t){!function(n){"object"==typeof e.exports?n(i("1157"),window,document):n(t,window,document)}((function(e,t,i,n){function s(t,i){this.$chartContainer=e(t),this.opts=i,this.defaultOptions={nodeTitle:"name",nodeId:"id",toggleSiblingsResp:!1,visibleLevel:999,chartClass:"",exportButton:!1,exportButtonName:"Export",exportFilename:"OrgChart",exportFileextension:"png",parentNodeSymbol:"oci-leader",draggable:!1,direction:"t2b",pan:!1,zoom:!1,zoominLimit:7,zoomoutLimit:.5}}s.prototype={init:function(t){var i=this;this.options=e.extend({},this.defaultOptions,this.opts,t);var n=this.$chartContainer;this.$chart&&this.$chart.remove();var s=this.options.data,a=this.$chart=e("<div>",{data:{options:this.options},class:"orgchart"+(""!==this.options.chartClass?" "+this.options.chartClass:"")+("t2b"!==this.options.direction?" "+this.options.direction:""),click:function(t){e(t.target).closest(".node").length||a.find(".node.focused").removeClass("focused")}});return"undefined"!=typeof MutationObserver&&this.triggerInitEvent(),"object"===e.type(s)?s instanceof e?this.buildHierarchy(a,this.buildJsonDS(s.children()),0,this.options):this.buildHierarchy(a,this.options.ajaxURL?s:this.attachRel(s,"00")):(a.append('<i class="oci oci-spinner spinner"></i>'),e.ajax({url:s,dataType:"json"}).done((function(e,t,n){i.buildHierarchy(a,i.options.ajaxURL?e:i.attachRel(e,"00"),0,i.options)})).fail((function(e,t,i){console.log(i)})).always((function(){a.children(".spinner").remove()}))),n.append(a),this.options.exportButton&&!n.find(".oc-export-btn").length&&this.attachExportButton(),this.options.pan&&this.bindPan(),this.options.zoom&&this.bindZoom(),this},triggerInitEvent:function(){var t=this,i=new MutationObserver((function(n){i.disconnect();e:for(var s=0;s<n.length;s++)for(var a=0;a<n[s].addedNodes.length;a++)if(n[s].addedNodes[a].classList.contains("orgchart")){t.options.initCompleted&&"function"==typeof t.options.initCompleted&&t.options.initCompleted(t.$chart);var r=e.Event("init.orgchart");t.$chart.trigger(r);break e}}));i.observe(this.$chartContainer[0],{childList:!0})},triggerLoadEvent:function(t,i){var n=e.Event("load-"+i+".orgchart");t.trigger(n)},triggerShowEvent:function(t,i){var n=e.Event("show-"+i+".orgchart");t.trigger(n)},triggerHideEvent:function(t,i){var n=e.Event("hide-"+i+".orgchart");t.trigger(n)},attachExportButton:function(){var t=this,i=e("<button>",{class:"oc-export-btn"+(""!==this.options.chartClass?" "+this.options.chartClass:""),text:this.options.exportButtonName,click:function(e){e.preventDefault(),t.export()}});this.$chartContainer.append(i)},setOptions:function(e,t){return"string"==typeof e&&("pan"===e&&(t?this.bindPan():this.unbindPan()),"zoom"===e&&(t?this.bindZoom():this.unbindZoom())),"object"==typeof e&&(e.data?this.init(e):(void 0!==e.pan&&(e.pan?this.bindPan():this.unbindPan()),void 0!==e.zoom&&(e.zoom?this.bindZoom():this.unbindZoom()))),this},panStartHandler:function(t){var i=e(t.delegateTarget);if(e(t.target).closest(".node").length||t.touches&&1<t.touches.length)i.data("panning",!1);else{i.css("cursor","move").data("panning",!0);var n=0,s=0,a=i.css("transform");if("none"!==a){var r=a.split(",");s=-1===a.indexOf("3d")?(n=parseInt(r[4]),parseInt(r[5])):(n=parseInt(r[12]),parseInt(r[13]))}var o=0,d=0;if(t.targetTouches){if(1===t.targetTouches.length)o=t.targetTouches[0].pageX-n,d=t.targetTouches[0].pageY-s;else if(1<t.targetTouches.length)return}else o=t.pageX-n,d=t.pageY-s;i.on("mousemove touchmove",(function(e){if(i.data("panning")){var t=0,n=0;if(e.targetTouches){if(1===e.targetTouches.length)t=e.targetTouches[0].pageX-o,n=e.targetTouches[0].pageY-d;else if(1<e.targetTouches.length)return}else t=e.pageX-o,n=e.pageY-d;var s=i.css("transform");if("none"===s)-1===s.indexOf("3d")?i.css("transform","matrix(1, 0, 0, 1, "+t+", "+n+")"):i.css("transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+t+", "+n+", 0, 1)");else{var a=s.split(",");-1===s.indexOf("3d")?(a[4]=" "+t,a[5]=" "+n+")"):(a[12]=" "+t,a[13]=" "+n),i.css("transform",a.join(","))}}}))}},panEndHandler:function(e){e.data.chart.data("panning")&&e.data.chart.data("panning",!1).css("cursor","default").off("mousemove")},bindPan:function(){this.$chartContainer.css("overflow","hidden"),this.$chart.on("mousedown touchstart",this.panStartHandler),e(i).on("mouseup touchend",{chart:this.$chart},this.panEndHandler)},unbindPan:function(){this.$chartContainer.css("overflow","auto"),this.$chart.off("mousedown touchstart",this.panStartHandler),e(i).off("mouseup touchend",this.panEndHandler)},zoomWheelHandler:function(e){var t=e.data.oc;e.preventDefault();var i=1+(0<e.originalEvent.deltaY?-.2:.2);t.setChartScale(t.$chart,i)},zoomStartHandler:function(e){if(e.touches&&2===e.touches.length){var t=e.data.oc;t.$chart.data("pinching",!0);var i=t.getPinchDist(e);t.$chart.data("pinchDistStart",i)}},zoomingHandler:function(e){var t=e.data.oc;if(t.$chart.data("pinching")){var i=t.getPinchDist(e);t.$chart.data("pinchDistEnd",i)}},zoomEndHandler:function(e){var t=e.data.oc;if(t.$chart.data("pinching")){t.$chart.data("pinching",!1);var i=t.$chart.data("pinchDistEnd")-t.$chart.data("pinchDistStart");0<i?t.setChartScale(t.$chart,1.2):i<0&&t.setChartScale(t.$chart,.8)}},bindZoom:function(){this.$chartContainer.on("wheel",{oc:this},this.zoomWheelHandler),this.$chartContainer.on("touchstart",{oc:this},this.zoomStartHandler),e(i).on("touchmove",{oc:this},this.zoomingHandler),e(i).on("touchend",{oc:this},this.zoomEndHandler)},unbindZoom:function(){this.$chartContainer.off("wheel",this.zoomWheelHandler),this.$chartContainer.off("touchstart",this.zoomStartHandler),e(i).off("touchmove",this.zoomingHandler),e(i).off("touchend",this.zoomEndHandler)},getPinchDist:function(e){return Math.sqrt((e.touches[0].clientX-e.touches[1].clientX)*(e.touches[0].clientX-e.touches[1].clientX)+(e.touches[0].clientY-e.touches[1].clientY)*(e.touches[0].clientY-e.touches[1].clientY))},setChartScale:function(e,i){var n=e.data("options"),s=e.css("transform"),a="",r=1;"none"===s?e.css("transform","scale("+i+","+i+")"):(a=s.split(","),-1===s.indexOf("3d")?(r=Math.abs(t.parseFloat(a[3])*i))>n.zoomoutLimit&&r<n.zoominLimit&&e.css("transform",s+" scale("+i+","+i+")"):(r=Math.abs(t.parseFloat(a[1])*i))>n.zoomoutLimit&&r<n.zoominLimit&&e.css("transform",s+" scale3d("+i+","+i+", 1)"))},buildJsonDS:function(t){var i=this,n={name:t.contents().eq(0).text().trim(),relationship:(t.parent().parent().is("li")?"1":"0")+(t.siblings("li").length?1:0)+(t.children("ul").length?1:0)};return e.each(t.data(),(function(e,t){n[e]=t})),t.children("ul").children().each((function(){n.children||(n.children=[]),n.children.push(i.buildJsonDS(e(this)))})),n},attachRel:function(e,t){var i=this;return e.relationship=t+(e.children&&0<e.children.length?1:0),e.children&&e.children.forEach((function(t){i.attachRel(t,"1"+(1<e.children.length?1:0))})),e},loopChart:function(t,i){i=null!==i&&i!==n&&i;var s=this,a=t.find("tr:first"),r={id:a.find(".node")[0].id};if(i){var o=e(a.find(".node")[0]);e.each(o.data("nodeData"),(function(e,t){r[e]=t}))}return a.siblings(":last").children().each((function(){r.children||(r.children=[]),r.children.push(s.loopChart(e(this),i))})),r},getHierarchy:function(e){if(e=null!==e&&e!==n&&e,void 0===this.$chart)return"Error: orgchart does not exist";if(!this.$chart.find(".node").length)return"Error: nodes do not exist";var t=!0;return this.$chart.find(".node").each((function(){if(!this.id)return t=!1})),t?this.loopChart(this.$chart,e):"Error: All nodes of orghcart to be exported must have data-id attribute!"},getNodeState:function(e,t){var i={},n=e.parent().is("li");if("parent"===(t=t||"self")){if(n?(i=e.closest("ul").parents("ul")).length||(i=e.closest(".nodes")).length||(i=e.closest(".verticalNodes").siblings(":first")):i=e.closest(".nodes").siblings(":first"),i.length)return i.is(".hidden")||!i.is(".hidden")&&i.closest(".nodes").is(".hidden")||!i.is(".hidden")&&i.closest(".verticalNodes").is(".hidden")?{exist:!0,visible:!1}:{exist:!0,visible:!0}}else if("children"===t){if((i=n?e.parent().children("ul"):e.closest("tr").siblings(":last")).length)return i.is(".hidden")?{exist:!0,visible:!1}:{exist:!0,visible:!0}}else if("siblings"===t){if((i=n?e.closest("ul"):e.closest("table").parent().siblings()).length&&(!n||1<i.children("li").length))return i.is(".hidden")||i.parent().is(".hidden")||n&&i.closest(".verticalNodes").is(".hidden")?{exist:!0,visible:!1}:{exist:!0,visible:!0}}else if((i=e).length)return i.closest(".nodes").length&&i.closest(".nodes").is(".hidden")||i.closest("table").parent().length&&i.closest("table").parent().is(".hidden")||i.parent().is("li")&&(i.closest("ul").is(".hidden")||i.closest(".verticalNodes").is(".hidden"))?{exist:!0,visible:!1}:{exist:!0,visible:!0};return{exist:!1,visible:!1}},getRelatedNodes:function(t,i){return t&&t instanceof e&&t.is(".node")?"parent"===i?t.closest(".nodes").parent().children(":first").find(".node"):"children"===i?t.closest("tr").siblings(".nodes").children().find(".node:first"):"siblings"===i?t.closest("table").parent().siblings().find(".node:first"):e():e()},hideParentEnd:function(t){e(t.target).removeClass("sliding"),t.data.upperLevel.addClass("hidden").slice(1).removeAttr("style")},hideParent:function(e){var t=e.closest(".nodes").siblings();t.eq(0).find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1),this.getNodeState(e,"siblings").visible&&this.hideSiblings(e),t.slice(1).css("visibility","hidden");var i=t.eq(0).find(".node");this.getNodeState(i).visible&&i.addClass("sliding slide-down").one("transitionend",{upperLevel:t},this.hideParentEnd),this.getNodeState(i,"parent").visible&&this.hideParent(i)},showParentEnd:function(t){var i=t.data.node;e(t.target).removeClass("sliding"),this.isInAction(i)&&this.switchVerticalArrow(i.children(".topEdge"))},showParent:function(e){var t=e.closest(".nodes").siblings().removeClass("hidden");t.eq(2).children().slice(1,-1).addClass("hidden");var i=t.eq(0).find(".node");this.repaint(i[0]),i.addClass("sliding").removeClass("slide-down").one("transitionend",{node:e},this.showParentEnd.bind(this))},stopAjax:function(e){e.find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1)},isVisibleNode:function(t,i){return this.getNodeState(e(i)).visible},hideChildrenEnd:function(e){var t=e.data.node;e.data.animatedNodes.removeClass("sliding"),e.data.isVerticalDesc?e.data.lowerLevel.addClass("hidden"):(e.data.animatedNodes.closest(".nodes").prevAll(".lines").removeAttr("style").addBack().addClass("hidden"),e.data.lowerLevel.last().find(".verticalNodes").addClass("hidden")),this.isInAction(t)&&this.switchVerticalArrow(t.children(".bottomEdge"))},hideChildren:function(e){var t=e.closest("tr").siblings();this.stopAjax(t.last());var i=t.last().find(".node").filter(this.isVisibleNode.bind(this)),n=!!t.last().is(".verticalNodes");n||i.closest("table").closest("tr").prevAll(".lines").css("visibility","hidden"),this.repaint(i.get(0)),i.addClass("sliding slide-up").eq(0).one("transitionend",{animatedNodes:i,lowerLevel:t,isVerticalDesc:n,node:e},this.hideChildrenEnd.bind(this))},showChildrenEnd:function(e){var t=e.data.node;e.data.animatedNodes.removeClass("sliding"),this.isInAction(t)&&this.switchVerticalArrow(t.children(".bottomEdge"))},showChildren:function(e){var t=e.closest("tr").siblings(),i=t.is(".verticalNodes")?t.removeClass("hidden").find(".node").filter(this.isVisibleNode.bind(this)):t.removeClass("hidden").eq(2).children().find(".node:first").filter(this.isVisibleNode.bind(this));this.repaint(i.get(0)),i.addClass("sliding").removeClass("slide-up").eq(0).one("transitionend",{node:e,animatedNodes:i},this.showChildrenEnd.bind(this))},hideSiblingsEnd:function(e){var t=e.data.node,i=e.data.nodeContainer,n=e.data.direction;e.data.lines.removeAttr("style");var s=n?"left"===n?i.prevAll(":not(.hidden)"):i.nextAll(":not(.hidden)"):i.siblings();i.closest(".nodes").prev().children(":not(.hidden)").slice(1,n?2*s.length+1:-1).addClass("hidden"),e.data.animatedNodes.removeClass("sliding"),s.find(".node:gt(0)").filter(this.isVisibleNode.bind(this)).removeClass("slide-left slide-right").addClass("slide-up"),s.find(".lines, .nodes, .verticalNodes").addClass("hidden").end().addClass("hidden"),this.isInAction(t)&&this.switchHorizontalArrow(t)},hideSiblings:function(e,t){var i=e.closest("table").parent();i.siblings().find(".spinner").length&&e.closest(".orgchart").data("inAjax",!1),t?"left"===t?i.prevAll().find(".node").filter(this.isVisibleNode.bind(this)).addClass("sliding slide-right"):i.nextAll().find(".node").filter(this.isVisibleNode.bind(this)).addClass("sliding slide-left"):(i.prevAll().find(".node").filter(this.isVisibleNode.bind(this)).addClass("sliding slide-right"),i.nextAll().find(".node").filter(this.isVisibleNode.bind(this)).addClass("sliding slide-left"));var n=i.siblings().find(".sliding"),s=n.closest(".nodes").prevAll(".lines").css("visibility","hidden");n.eq(0).one("transitionend",{node:e,nodeContainer:i,direction:t,animatedNodes:n,lines:s},this.hideSiblingsEnd.bind(this))},showSiblingsEnd:function(e){var t=e.data.node;e.data.visibleNodes.removeClass("sliding"),this.isInAction(t)&&(this.switchHorizontalArrow(t),t.children(".topEdge").removeClass("oci-chevron-up").addClass("oci-chevron-down"))},showRelatedParentEnd:function(t){e(t.target).removeClass("sliding")},showSiblings:function(t,i){var n=e();n=i?"left"===i?t.closest("table").parent().prevAll().removeClass("hidden"):t.closest("table").parent().nextAll().removeClass("hidden"):t.closest("table").parent().siblings().removeClass("hidden");var s=t.closest("table").closest("tr").siblings();if(i?s.eq(2).children(".hidden").slice(0,2*n.length).removeClass("hidden"):s.eq(2).children(".hidden").removeClass("hidden"),!this.getNodeState(t,"parent").visible){s.removeClass("hidden");var a=s.find(".node")[0];this.repaint(a),e(a).addClass("sliding").removeClass("slide-down").one("transitionend",this.showRelatedParentEnd)}var r=n.find(".node").filter(this.isVisibleNode.bind(this));this.repaint(r.get(0)),r.addClass("sliding").removeClass("slide-left slide-right"),r.eq(0).one("transitionend",{node:t,visibleNodes:r},this.showSiblingsEnd.bind(this))},startLoading:function(t){var i=this.$chart;return(void 0===i.data("inAjax")||!0!==i.data("inAjax"))&&(t.addClass("hidden"),t.parent().append('<i class="oci oci-spinner spinner"></i>').children().not(".spinner").css("opacity",.2),i.data("inAjax",!0),e(".oc-export-btn"+(""!==this.options.chartClass?"."+this.options.chartClass:"")).prop("disabled",!0),!0)},endLoading:function(t){var i=t.parent();t.removeClass("hidden"),i.find(".spinner").remove(),i.children().removeAttr("style"),this.$chart.data("inAjax",!1),e(".oc-export-btn"+(""!==this.options.chartClass?"."+this.options.chartClass:"")).prop("disabled",!1)},isInAction:function(e){return-1<e.children(".edge").attr("class").indexOf("oci-")},switchVerticalArrow:function(e){e.toggleClass("oci-chevron-up").toggleClass("oci-chevron-down")},switchHorizontalArrow:function(e){var t=this.options;if(t.toggleSiblingsResp&&(void 0===t.ajaxURL||e.closest(".nodes").data("siblingsLoaded"))){var i=e.closest("table").parent().prev();i.length&&(i.is(".hidden")?e.children(".leftEdge").addClass("oci-chevron-left").removeClass("oci-chevron-right"):e.children(".leftEdge").addClass("oci-chevron-right").removeClass("oci-chevron-left"));var n=e.closest("table").parent().next();n.length&&(n.is(".hidden")?e.children(".rightEdge").addClass("oci-chevron-right").removeClass("oci-chevron-left"):e.children(".rightEdge").addClass("oci-chevron-left").removeClass("oci-chevron-right"))}else{var s=e.closest("table").parent().siblings(),a=!!s.length&&!s.is(".hidden");e.children(".leftEdge").toggleClass("oci-chevron-right",a).toggleClass("oci-chevron-left",!a),e.children(".rightEdge").toggleClass("oci-chevron-left",a).toggleClass("oci-chevron-right",!a)}},repaint:function(e){e&&(e.style.offsetWidth=e.offsetWidth)},nodeEnterLeaveHandler:function(t){var i=e(t.delegateTarget),n=!1,s=i.children(".topEdge"),a=(i.children(".rightEdge"),i.children(".bottomEdge")),r=i.children(".leftEdge");"mouseenter"===t.type?(s.length&&(n=this.getNodeState(i,"parent").visible,s.toggleClass("oci-chevron-up",!n).toggleClass("oci-chevron-down",n)),a.length&&(n=this.getNodeState(i,"children").visible,a.toggleClass("oci-chevron-down",!n).toggleClass("oci-chevron-up",n)),r.length&&this.switchHorizontalArrow(i)):i.children(".edge").removeClass("oci-chevron-up oci-chevron-down oci-chevron-right oci-chevron-left")},nodeClickHandler:function(t){this.$chart.find(".focused").removeClass("focused"),e(t.delegateTarget).addClass("focused")},loadNodes:function(t,i,n){var s=this;this.options,e.ajax({url:i,dataType:"json"}).done((function(i){s.$chart.data("inAjax")&&("parent"===t?e.isEmptyObject(i)||s.addParent(n.parent(),i):"children"===t?i.children.length&&s.addChildren(n.parent(),i[t]):s.addSiblings(n.parent(),i.siblings?i.siblings:i),s.triggerLoadEvent(n.parent(),t))})).fail((function(){console.log("Failed to get "+t+" data")})).always((function(){s.endLoading(n)}))},HideFirstParentEnd:function(e){var t=e.data.topEdge,i=t.parent();this.isInAction(i)&&(this.switchVerticalArrow(t),this.switchHorizontalArrow(i))},topEdgeClickHandler:function(t){t.stopPropagation();var i=e(t.target),n=e(t.delegateTarget),s=this.getNodeState(n,"parent");if(s.exist){var a=n.closest("table").closest("tr").siblings(":first").find(".node");if(a.is(".sliding"))return;s.visible?(this.hideParent(n),a.one("transitionend",{topEdge:i},this.HideFirstParentEnd.bind(this)),this.triggerHideEvent(n,"parent")):(this.showParent(n),this.triggerShowEvent(n,"parent"))}else if(this.startLoading(i)){var r=this.options,o=e.isFunction(r.ajaxURL.parent)?r.ajaxURL.parent(n.data("nodeData")):r.ajaxURL.parent+n[0].id;this.loadNodes("parent",o,i)}},bottomEdgeClickHandler:function(t){t.stopPropagation();var i=e(t.target),n=e(t.delegateTarget),s=this.getNodeState(n,"children");if(s.exist){if(n.closest("tr").siblings(":last").find(".sliding").length)return;s.visible?(this.hideChildren(n),this.triggerHideEvent(n,"children")):(this.showChildren(n),this.triggerShowEvent(n,"children"))}else if(this.startLoading(i)){var a=this.options,r=e.isFunction(a.ajaxURL.children)?a.ajaxURL.children(n.data("nodeData")):a.ajaxURL.children+n[0].id;this.loadNodes("children",r,i)}},hEdgeClickHandler:function(t){t.stopPropagation();var i=e(t.target),n=e(t.delegateTarget),s=this.options,a=this.getNodeState(n,"siblings");if(a.exist){if(n.closest("table").parent().siblings().find(".sliding").length)return;if(s.toggleSiblingsResp){var r=n.closest("table").parent().prev(),o=n.closest("table").parent().next();i.is(".leftEdge")?r.is(".hidden")?(this.showSiblings(n,"left"),this.triggerShowEvent(n,"siblings")):(this.hideSiblings(n,"left"),this.triggerHideEvent(n,"siblings")):o.is(".hidden")?(this.showSiblings(n,"right"),this.triggerShowEvent(n,"siblings")):(this.hideSiblings(n,"right"),this.triggerHideEvent(n,"siblings"))}else a.visible?(this.hideSiblings(n),this.triggerHideEvent(n,"siblings")):(this.showSiblings(n),this.triggerShowEvent(n,"siblings"))}else if(this.startLoading(i)){var d=n[0].id,l=this.getNodeState(n,"parent").exist?e.isFunction(s.ajaxURL.siblings)?s.ajaxURL.siblings(n.data("nodeData")):s.ajaxURL.siblings+d:e.isFunction(s.ajaxURL.families)?s.ajaxURL.families(n.data("nodeData")):s.ajaxURL.families+d;this.loadNodes("siblings",l,i)}},expandVNodesEnd:function(e){e.data.vNodes.removeClass("sliding")},collapseVNodesEnd:function(e){e.data.vNodes.removeClass("sliding").closest("ul").addClass("hidden")},toggleVNodes:function(t){var i=e(t.target),n=i.parent().next(),s=n.find(".node"),a=n.children().children(".node");a.is(".sliding")||(i.toggleClass("oci-plus-square oci-minus-square"),s.eq(0).is(".slide-up")?(n.removeClass("hidden"),this.repaint(a.get(0)),a.addClass("sliding").removeClass("slide-up").eq(0).one("transitionend",{vNodes:a},this.expandVNodesEnd)):(s.addClass("sliding slide-up").eq(0).one("transitionend",{vNodes:s},this.collapseVNodesEnd),s.find(".toggleBtn").removeClass("oci-minus-square").addClass("oci-plus-square")))},createGhostNode:function(n){var s,a,r=e(n.target),o=this.options,d=n.originalEvent,l=/firefox/.test(t.navigator.userAgent.toLowerCase());if(i.querySelector(".ghost-node"))s=r.closest(".orgchart").children(".ghost-node").get(0),a=e(s).children().get(0);else{if(!(s=i.createElementNS("http://www.w3.org/2000/svg","svg")).classList)return;s.classList.add("ghost-node"),a=i.createElementNS("http://www.w3.org/2000/svg","rect"),s.appendChild(a),r.closest(".orgchart").append(s)}var c=r.closest(".orgchart").css("transform").split(","),h="t2b"===o.direction||"b2t"===o.direction,g=Math.abs(t.parseFloat(h?c[0].slice(c[0].indexOf("(")+1):c[1]));s.setAttribute("width",h?r.outerWidth(!1):r.outerHeight(!1)),s.setAttribute("height",h?r.outerHeight(!1):r.outerWidth(!1)),a.setAttribute("x",5*g),a.setAttribute("y",5*g),a.setAttribute("width",120*g),a.setAttribute("height",40*g),a.setAttribute("rx",4*g),a.setAttribute("ry",4*g),a.setAttribute("stroke-width",1*g);var u=d.offsetX*g,p=d.offsetY*g;if("l2r"===o.direction?(u=d.offsetY*g,p=d.offsetX*g):"r2l"===o.direction?(u=r.outerWidth(!1)-d.offsetY*g,p=d.offsetX*g):"b2t"===o.direction&&(u=r.outerWidth(!1)-d.offsetX*g,p=r.outerHeight(!1)-d.offsetY*g),l){a.setAttribute("fill","rgb(255, 255, 255)"),a.setAttribute("stroke","rgb(191, 0, 0)");var f=i.createElement("img");f.src="data:image/svg+xml;utf8,"+(new XMLSerializer).serializeToString(s),d.dataTransfer.setDragImage(f,u,p)}else d.dataTransfer.setDragImage&&d.dataTransfer.setDragImage(s,u,p)},filterAllowedDropNodes:function(t){var i=this.options,n=t.closest("[draggable]").hasClass("node"),s=t.closest(".nodes").siblings().eq(0).find(".node:first"),a=t.closest("table").find(".node");this.$chart.data("dragged",t).find(".node").each((function(r,o){n&&-1!==a.index(o)||(i.dropCriteria?i.dropCriteria(t,s,e(o))&&e(o).addClass("allowedDrop"):e(o).addClass("allowedDrop"))}))},dragstartHandler:function(t){t.originalEvent.dataTransfer.setData("text/html","hack for firefox"),"none"!==this.$chart.css("transform")&&this.createGhostNode(t),this.filterAllowedDropNodes(e(t.target))},dragoverHandler:function(t){e(t.delegateTarget).is(".allowedDrop")?t.preventDefault():t.originalEvent.dataTransfer.dropEffect="none"},dragendHandler:function(e){this.$chart.find(".allowedDrop").removeClass("allowedDrop")},dropHandler:function(t){var i=e(t.delegateTarget),n=this.$chart.data("dragged");if(n.hasClass("node")){if(i.hasClass("allowedDrop")){var s=n.closest(".nodes").siblings().eq(0).children(),a=e.Event("nodedrop.orgchart");if(this.$chart.trigger(a,{draggedNode:n,dragZone:s.children(),dropZone:i}),!a.isDefaultPrevented()){if(i.closest("tr").siblings().length){var r=parseInt(i.parent().attr("colspan"))+2,o='<i class="edge horizontalEdge rightEdge oci"></i><i class="edge horizontalEdge leftEdge oci"></i>';i.closest("tr").next().addBack().children().attr("colspan",r),n.find(".horizontalEdge").length||n.append(o),i.closest("tr").siblings().eq(1).children(":last").before('<td class="leftLine topLine"></td><td class="rightLine topLine"></td>').end().next().append(n.closest("table").parent());var d=n.closest("table").parent().siblings().find(".node:first");1===d.length&&d.append(o)}else i.append('<i class="edge verticalEdge bottomEdge oci"></i>').parent().attr("colspan",2).parent().after('<tr class="lines"><td colspan="2"><div class="downLine"></div></td></tr><tr class="lines"><td class="rightLine"></td><td class="leftLine"></td></tr><tr class="nodes"></tr>').siblings(":last").append(n.find(".horizontalEdge").remove().end().closest("table").parent());var l=parseInt(s.attr("colspan"));if(2<l){s.attr("colspan",l-2).parent().next().children().attr("colspan",l-2).end().next().children().slice(1,3).remove();var c=s.parent().siblings(".nodes").children().find(".node:first");1===c.length&&c.find(".horizontalEdge").remove()}else s.removeAttr("colspan").find(".bottomEdge").remove().end().end().siblings().remove()}}}else this.$chart.triggerHandler({type:"otherdropped.orgchart",draggedItem:n,dropZone:i})},touchstartHandler:function(e){this.touchHandled||e.touches&&1<e.touches.length||(this.touchHandled=!0,this.touchMoved=!1,e.preventDefault())},touchmoveHandler:function(t){if(this.touchHandled&&!(t.touches&&1<t.touches.length)){t.preventDefault(),this.touchMoved||(this.filterAllowedDropNodes(e(t.currentTarget)),this.touchDragImage=this.createDragImage(t,this.$chart.data("dragged")[0])),this.touchMoved=!0,this.moveDragImage(t,this.touchDragImage);var n=e(i.elementFromPoint(t.touches[0].clientX,t.touches[0].clientY)).closest("div.node");if(0<n.length){var s=n[0];n.is(".allowedDrop")?this.touchTargetNode=s:this.touchTargetNode=null}else this.touchTargetNode=null}},touchendHandler:function(e){if(this.touchHandled){if(this.destroyDragImage(),this.touchMoved){if(this.touchTargetNode){var n={delegateTarget:this.touchTargetNode};this.dropHandler(n),this.touchTargetNode=null}this.dragendHandler(e)}else{var s=e.changedTouches[0],a=i.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,t,1,s.screenX,s.screenY,s.clientX,s.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),e.target.dispatchEvent(a)}this.touchHandled=!1}},createDragImage:function(e,t){var n=t.cloneNode(!0);this.copyStyle(t,n),n.style.top=n.style.left="-9999px";var s=t.getBoundingClientRect(),a=this.getTouchPoint(e);return this.touchDragImageOffset={x:a.x-s.left,y:a.y-s.top},n.style.opacity="0.5",i.body.appendChild(n),n},destroyDragImage:function(){this.touchDragImage&&this.touchDragImage.parentElement&&this.touchDragImage.parentElement.removeChild(this.touchDragImage),this.touchDragImageOffset=null,this.touchDragImage=null},copyStyle:function(e,t){if(["id","class","style","draggable"].forEach((function(e){t.removeAttribute(e)})),e instanceof HTMLCanvasElement){var i=e,n=t;n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0)}for(var s=getComputedStyle(e),a=0;a<s.length;a++){var r=s[a];r.indexOf("transition")<0&&(t.style[r]=s[r])}for(t.style.pointerEvents="none",a=0;a<e.children.length;a++)this.copyStyle(e.children[a],t.children[a])},getTouchPoint:function(e){return e&&e.touches&&(e=e.touches[0]),{x:e.clientX,y:e.clientY}},moveDragImage:function(e,t){if(e&&t){var i=this;requestAnimationFrame((function(){var n=i.getTouchPoint(e),s=t.style;s.position="absolute",s.pointerEvents="none",s.zIndex="999999",i.touchDragImageOffset&&(s.left=Math.round(n.x-i.touchDragImageOffset.x)+"px",s.top=Math.round(n.y-i.touchDragImageOffset.y)+"px")}))}},bindDragDrop:function(e){e.on("dragstart",this.dragstartHandler.bind(this)).on("dragover",this.dragoverHandler.bind(this)).on("dragend",this.dragendHandler.bind(this)).on("drop",this.dropHandler.bind(this)).on("touchstart",this.touchstartHandler.bind(this)).on("touchmove",this.touchmoveHandler.bind(this)).on("touchend",this.touchendHandler.bind(this))},createNode:function(t){var i=this.options,n=t.level;t.children&&t[i.nodeId]&&e.each(t.children,(function(e,n){n.parentId=t[i.nodeId]}));var s=e("<div"+(i.draggable?' draggable="true"':"")+(t[i.nodeId]?' id="'+t[i.nodeId]+'"':"")+(t.parentId?' data-parent="'+t.parentId+'"':"")+">").addClass("node "+(t.className||"")+(n>i.visibleLevel?" slide-up":""));i.nodeTemplate?s.append(i.nodeTemplate(t)):s.append('<div class="title">'+t[i.nodeTitle]+"</div>").append(void 0!==i.nodeContent?'<div class="content">'+(t[i.nodeContent]||"")+"</div>":"");var a=e.extend({},t);delete a.children,s.data("nodeData",a);var r=t.relationship||"";if(i.verticalLevel&&n>=i.verticalLevel){if(n+1>i.verticalLevel&&Number(r.substr(2,1))){var o=n+1>i.visibleLevel?"plus":"minus";s.append('<i class="toggleBtn oci oci-'+o+'-square"></i>')}}else Number(r.substr(0,1))&&s.append('<i class="edge verticalEdge topEdge oci"></i>'),Number(r.substr(1,1))&&s.append('<i class="edge horizontalEdge rightEdge oci"></i><i class="edge horizontalEdge leftEdge oci"></i>'),Number(r.substr(2,1))&&s.append('<i class="edge verticalEdge bottomEdge oci"></i>').children(".title").prepend('<i class="oci '+i.parentNodeSymbol+' symbol"></i>');return s.on("mouseenter mouseleave",this.nodeEnterLeaveHandler.bind(this)),s.on("click",this.nodeClickHandler.bind(this)),s.on("click",".topEdge",this.topEdgeClickHandler.bind(this)),s.on("click",".bottomEdge",this.bottomEdgeClickHandler.bind(this)),s.on("click",".leftEdge, .rightEdge",this.hEdgeClickHandler.bind(this)),s.on("click",".toggleBtn",this.toggleVNodes.bind(this)),i.draggable&&(this.bindDragDrop(s),this.touchHandled=!1,this.touchMoved=!1,this.touchTargetNode=null),i.createNode&&i.createNode(s,t),s},buildHierarchy:function(t,i){var n=this,s=this.options,a=0;a=i.level?i.level:i.level=t.parentsUntil(".orgchart",".nodes").length+1;var r,o=i.children,d=!!o&&o.length;if(2<Object.keys(i).length){var l=this.createNode(i);s.verticalLevel&&a>=s.verticalLevel?t.append(l):(r=e("<table>"),t.append(r.append(e("<tr/>").append(e("<td"+(d?' colspan="'+2*o.length+'"':"")+"></td>").append(l)))))}if(d){var c,h=a+1>s.visibleLevel||i.collapsed?" hidden":"",g=!!(s.verticalLevel&&a+1>=s.verticalLevel);if(g)c=e("<ul>"),h&&a+1>s.verticalLevel&&c.addClass(h),a+1===s.verticalLevel?t.children("table").append('<tr class="verticalNodes'+h+'"><td></td></tr>').find(".verticalNodes").children().append(c):t.append(c);else{for(var u=e('<tr class="lines'+h+'"><td colspan="'+2*o.length+'"><div class="downLine"></div></td></tr>'),p='<tr class="lines'+h+'"><td class="rightLine"></td>',f=1;f<o.length;f++)p+='<td class="leftLine topLine"></td><td class="rightLine topLine"></td>';p+='<td class="leftLine"></td></tr>',c=e('<tr class="nodes'+h+'">'),2===Object.keys(i).length?t.append(u).append(p).append(c):r.append(u).append(p).append(c)}e.each(o,(function(){var t=e(g?"<li>":'<td colspan="2">');c.append(t),this.level=a+1,n.buildHierarchy(t,this)}))}},buildChildNode:function(e,t){e.find("td:first").attr("colspan",2*t.length),this.buildHierarchy(e,{children:t})},addChildren:function(e,t){this.buildChildNode(e.closest("table"),t),e.children(".bottomEdge").length||e.append('<i class="edge verticalEdge bottomEdge oci"></i>'),e.find(".symbol").length||e.children(".title").prepend('<i class="oci '+this.options.parentNodeSymbol+' symbol"></i>'),this.isInAction(e)&&this.switchVerticalArrow(e.children(".bottomEdge"))},buildParentNode:function(t,i){i.relationship=i.relationship||"001";var n=e("<table>").append(e("<tr>").append(e('<td colspan="2">').append(this.createNode(i)))).append('<tr class="lines"><td colspan="2"><div class="downLine"></div></td></tr>').append('<tr class="lines"><td class="rightLine"></td><td class="leftLine"></td></tr>');this.$chart.prepend(n).children("table:first").append('<tr class="nodes"><td colspan="2"></td></tr>').children("tr:last").children().append(this.$chart.children("table").last())},addParent:function(e,t){this.buildParentNode(e,t),e.children(".topEdge").length||e.children(".title").after('<i class="edge verticalEdge topEdge oci"></i>'),this.isInAction(e)&&this.switchVerticalArrow(e.children(".topEdge"))},complementLine:function(e,t,i){for(var n="",s=0;s<i;s++)n+='<td class="leftLine topLine"></td><td class="rightLine topLine"></td>';e.parent().prevAll("tr:gt(0)").children().attr("colspan",2*t).end().next().children(":first").after(n)},buildSiblingNode:function(t,i){var n=e.isArray(i)?i.length:i.children.length,s=t.parent().is("td")?t.closest("tr").children().length:1,a=s+n,r=1<a?Math.floor(a/2-1):0;if(t.parent().is("td")){t.closest("tr").prevAll("tr:last"),t.closest("tr").prevAll("tr:lt(2)").remove(),this.buildChildNode(t.parent().closest("table"),i);var o=t.parent().closest("table").children("tr:last").children("td");1<s?this.complementLine(o.eq(0).before(t.closest("td").siblings().addBack().unwrap()),a,s):this.complementLine(o.eq(r).after(t.closest("td").unwrap()),a,1)}else this.buildHierarchy(t.closest(".orgchart"),i),this.complementLine(t.next().children("tr:last").children().eq(r).after(e('<td colspan="2">').append(t)),a,1)},addSiblings:function(e,t){this.buildSiblingNode(e.closest("table"),t),e.closest(".nodes").data("siblingsLoaded",!0),e.children(".leftEdge").length||e.children(".topEdge").after('<i class="edge horizontalEdge rightEdge oci"></i><i class="edge horizontalEdge leftEdge oci"></i>'),this.isInAction(e)&&(this.switchHorizontalArrow(e),e.children(".topEdge").removeClass("oci-chevron-up").addClass("oci-chevron-down"))},removeNodes:function(e){var t=e.closest("table").parent(),i=t.parent().siblings();t.is("td")?this.getNodeState(e,"siblings").exist?(i.eq(2).children(".topLine:lt(2)").remove(),i.slice(0,2).children().attr("colspan",i.eq(2).children().length),t.remove()):i.eq(0).children().removeAttr("colspan").find(".bottomEdge").remove().end().end().siblings().remove():t.add(t.siblings()).remove()},hideDropZones:function(){this.$chart.find(".allowedDrop").removeClass("allowedDrop")},showDropZones:function(t){this.$chart.find(".node").each((function(t,i){e(i).addClass("allowedDrop")})),this.$chart.data("dragged",e(t))},processExternalDrop:function(t,i){i&&this.$chart.data("dragged",e(i)),t.closest(".node").triggerHandler({type:"drop"})},exportPDF:function(e,t){var i={},n=Math.floor(e.width),s=Math.floor(e.height);(i=s<n?new jsPDF({orientation:"landscape",unit:"px",format:[n,s]}):new jsPDF({orientation:"portrait",unit:"px",format:[s,n]})).addImage(e.toDataURL(),"png",0,0),i.save(t+".pdf")},exportPNG:function(e,n){var s="WebkitAppearance"in i.documentElement.style,a=!!t.sidebar,r="Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&-1<navigator.appVersion.indexOf("Edge"),o=this.$chartContainer;if(!s&&!a||r)t.navigator.msSaveBlob(e.msToBlob(),n+".png");else{var d=".oci-download-btn"+(""!==this.options.chartClass?"."+this.options.chartClass:"");o.find(d).length||o.append('<a class="oci-download-btn'+(""!==this.options.chartClass?" "+this.options.chartClass:"")+'" download="'+n+'.png"></a>'),o.find(d).attr("href",e.toDataURL())[0].click()}},export:function(t,i){var n=this;if(t=void 0!==t?t:this.options.exportFilename,i=void 0!==i?i:this.options.exportFileextension,e(this).children(".spinner").length)return!1;var s=this.$chartContainer,a=s.find(".mask");a.length?a.removeClass("hidden"):s.append('<div class="mask"><i class="oci oci-spinner spinner"></i></div>');var r=s.addClass("canvasContainer").find('.orgchart:not(".hidden")').get(0),o="l2r"===n.options.direction||"r2l"===n.options.direction;html2canvas(r,{width:o?r.clientHeight:r.clientWidth,height:o?r.clientWidth:r.clientHeight,onclone:function(t){e(t).find(".canvasContainer").css("overflow","visible").find('.orgchart:not(".hidden"):first').css("transform","")}}).then((function(e){s.find(".mask").addClass("hidden"),"pdf"===i.toLowerCase()?n.exportPDF(e,t):n.exportPNG(e,t),s.removeClass("canvasContainer")}),(function(){s.removeClass("canvasContainer")}))}},e.fn.orgchart=function(e){return new s(this,e).init()}}))}).call(this,i("1157"))}}]);