(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/user/events/_id/posts/scheduled/index~pages/user/posts/_id/index~pages/user/posts/scheduled/index"],{"093e":function(t,e,o){},3485:function(t,e,o){"use strict";o("093e")},"7eb8":function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-card",{staticClass:"mt-3 mb-4",class:t.pinned?"elevation-5":"elevation-1"},[o("v-list-item",{attrs:{"two-line":""}},[o("v-list-item-avatar",["Division Notice"===t.post.category?o("v-avatar",{attrs:{size:40,color:"baseColor"}},[o("v-icon",{attrs:{dark:"",small:""},domProps:{textContent:t._s("mdi-quadcopter")}})],1):"Organization Notice"===t.post.category?o("v-avatar",{attrs:{size:40,color:"baseColor"}},[o("v-icon",{attrs:{dark:"",small:""},domProps:{textContent:t._s("mdi-bank")}})],1):"HR Notice"===t.post.category?o("v-avatar",{staticClass:"baseColor",attrs:{size:40}},[o("v-icon",{attrs:{dark:"",small:""},domProps:{textContent:t._s("mdi-shield-account")}})],1):o("v-avatar",{attrs:{size:40}},[o("v-img",{attrs:{src:t.getProfilePicture,cover:""}})],1)],1),o("v-list-item-content",[o("v-list-item-title",["Normal Post"!==t.post.category&&"Auto Generated"!==t.post.category&&"Condolence Post"!==t.post.category?o("div",{domProps:{textContent:t._s(t.getPostedBy)}}):"Auto Generated"!=t.post.category?[t.clickableUser?o("a",{domProps:{textContent:t._s(t.post.posted_by.full_name)},on:{click:function(e){return t.viewProfileDetail(t.post.posted_by.id)}}}):o("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[o("span",t._g({domProps:{textContent:t._s(t.post.posted_by.full_name)}},i))]}}])},[t.userStatus?o("span",{domProps:{textContent:t._s(t.userStatus)}}):t._e()])]:o("a",{domProps:{textContent:t._s(t.post.posted_by.full_name)},on:{click:function(e){"Auto Generated"!==t.post.category&&t.viewProfileDetail(t.post.posted_by.id)}}})],2),o("v-list-item-subtitle",{staticClass:"text-caption"},[o("span",{domProps:{textContent:t._s(t.humanizeDate(t.post.scheduled_for?t.post.scheduled_for:t.post.created_at))}}),o("v-tooltip",{attrs:{disabled:"Normal Post"===t.post.category,right:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return["Normal Post"!==t.post.category&&"Auto Generated"!==t.post.category?o("span",t._g({domProps:{textContent:t._s(" - "+t.post.category)}},i)):t._e()]}}])},[o("span",{domProps:{textContent:t._s("Posted By "+t.post.posted_by.full_name)}})]),t.humanizedTime(t.post.created_at)!==t.humanizedTime(t.post.modified_at)?o("span"):t._e()],1)],1),o("v-list-item-action",[o("v-row",[t.isScheduledPost?o("v-chip",{attrs:{small:"",color:t.tabsColors[t.post.status],outlined:""}},[t._v(" "+t._s(t.post.status)+" ")]):t._e(),t.pinned?o("v-icon",{attrs:{color:"info",size:"15"},domProps:{textContent:t._s("mdi-pin-outline")}}):t._e(),"HR Admin"===t.getUserCategory||t.post.posted_by.id===t.getAuthStateUser.user.id&&t.getNoticeBoardAllowPost?o("v-menu",{attrs:{bottom:"",left:"","offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[o("v-btn",t._g({attrs:{"data-cy":1===t.postIndex?"post-dropdown-menu-first":"post-dropdown-menu",icon:"",small:""}},i),[o("v-icon",{attrs:{small:""},domProps:{textContent:t._s("mdi-dots-vertical")}})],1)]}}],null,!1,750822686)},[o("v-list",{attrs:{dense:""}},[t.post.pinned||"HR Admin"!==t.getUserCategory?t._e():o("v-list-item",{attrs:{"data-cy":1===t.postIndex?"post-dropdown-menu-item-first":"post-dropdown-menu-item"},on:{click:function(e){t.pinNotification.dialog=!0}}},[o("v-list-item-title",[o("v-icon",{attrs:{small:""},domProps:{textContent:t._s("mdi-pin-outline")}}),o("span",{domProps:{textContent:t._s("Pin Notice")}})],1)],1),t.post.pinned&&"HR Admin"===t.getUserCategory?o("v-list-item",{attrs:{"data-cy":1===t.postIndex?"post-dropdown-menu-item-first":"post-dropdown-menu-item"},on:{click:function(e){t.unPinNotification.dialog=!0}}},[o("v-list-item-title",[o("v-icon",{attrs:{small:""},domProps:{textContent:t._s("mdi-pin-outline")}}),o("span",{domProps:{textContent:t._s("Unpin Notice")}})],1)],1):t._e(),t.post.posted_by.id===t.getAuthStateUser.user.id&&t.getNoticeBoardAllowPost||t.isScheduledPost?o("v-list-item",{attrs:{"data-cy":1===t.postIndex?"post-dropdown-menu-item-first":"post-dropdown-menu-item"},on:{click:function(e){t.noticeText=t.post.post_content,t.editNotice=!0}}},[o("v-list-item-title",[o("v-icon",{attrs:{small:""},domProps:{textContent:t._s("mdi-pencil")}}),o("span",{domProps:{textContent:t._s("Update Notice")}})],1)],1):t._e(),t.post.posted_by.id===t.getAuthStateUser.user.id&&t.getNoticeBoardAllowPost||"HR Admin"===t.getUserCategory||t.isScheduledPost||t.verifyPermission(t.allPermissions.CAN_UPDATE_DELETE_ANY_ONES_POST_COMMENTS,!0)?o("v-list-item",{attrs:{"data-cy":1===t.postIndex?"post-dropdown-menu-item-first":"post-dropdown-menu-item"},on:{click:function(e){t.deleteNotification.dialog=!0}}},[o("v-list-item-title",[o("v-icon",{attrs:{small:""},domProps:{textContent:t._s("mdi-delete")}}),o("span",{domProps:{textContent:t._s("Delete Notice")}})],1)],1):t._e()],1)],1):t._e()],1)],1)],1),o("v-card-text",{staticClass:"pt-0"},[t.editNotice?o("div",[t.isScheduledPost?o("div",[o("v-row",[o("v-col",{class:"HR Notice"===t.post.category?"md6":"md12"},[o("v-select",{attrs:{items:t.postTypes,messages:["Select type of this post."],label:"Post Type"},model:{value:t.post.category,callback:function(e){t.$set(t.post,"category",e)},expression:"post.category"}})],1),"HR Notice"===t.post.category?o("v-col",{attrs:{md:"6"}},[o("vue-date-time-picker",{attrs:{label:"HR Notice Visible Until"},model:{value:t.post.visibility_until,callback:function(e){t.$set(t.post,"visibility_until",e)},expression:"post.visibility_until"}})],1):t._e()],1),"HR Admin"===t.getUserCategory?o("v-row",[o("v-col",{attrs:{md:"6"}},[o("v-switch",{attrs:{label:"Do you want to pin this post?"},model:{value:t.post.pinned,callback:function(e){t.$set(t.post,"pinned",e)},expression:"post.pinned"}})],1),o("v-col",{attrs:{md:"6"}},[o("vue-date-time-picker",t._b({directives:[{name:"validate",rawName:"v-validate"}],attrs:{label:"Scheduled For"},model:{value:t.post.scheduled_for,callback:function(e){t.$set(t.post,"scheduled_for",e)},expression:"post.scheduled_for"}},"vue-date-time-picker",t.veeValidate("scheduled_for","Scheduled For"),!1))],1)],1):t._e(),o("v-divider")],1):t._e(),o("v-col",[o("vue-trumbowyg",t._b({directives:[{name:"validate",rawName:"v-validate",value:"max:20000",expression:"'max:20000'"}],attrs:{id:"trumbowyg","data-cy-variable":"notice_text"},model:{value:t.noticeText,callback:function(e){t.noticeText=e},expression:"noticeText"}},"vue-trumbowyg",t.veeValidate("post_content","Post Content*"),!1))],1)],1):[o("div",{staticClass:"user-content",staticStyle:{"white-space":"pre-wrap"},domProps:{innerHTML:t._s(t.getClickableLink(t.postContent))}}),t.post.upload_file?o("v-btn",{attrs:{"x-small":"",color:"primary",outlined:"",href:t.post.upload_file,target:"_blank"}},[o("v-icon",{attrs:{small:""}},[t._v("mdi-attachment")]),o("span",[t._v("Attachment")])],1):t._e()],t.url?o("link-preview",{attrs:{url:t.url}}):t._e(),o("post-attachment",{attrs:{attachments:t.post.attachments,editable:t.editNotice},on:{add:function(e){t.updatePost.newImages.files.unshift(e.file),t.updatePost.newImages.names.unshift(e.name)},delete:function(e){return t.updatePost.deletedImages.push(e)},remove:function(e){t.updatePost.newImages.files.splice(e,1),t.updatePost.newImages.names.splice(e,1)}}})],2),t.editNotice?o("v-card-actions",[o("v-spacer"),o("v-btn",{attrs:{disabled:!t.isScheduledPost&&(t.noticeText===t.post.post_content&&!t.get(t.updatePost.newImages.files,"length")&&!t.get(t.updatePost.deletedImages,"length")||t.loading),loading:t.loading,color:"primary",depressed:"",small:""},domProps:{textContent:t._s("Save")},on:{click:t.updateNotice}}),o("v-btn",{attrs:{outlined:"",small:""},domProps:{textContent:t._s("Cancel")},on:{click:function(e){t.editNotice=!1,t.updatePost.deletedImages=[],t.updatePost.newImages={names:[],files:[]}}}})],1):t._e(),t.editNotice||t.isScheduledPost?t._e():o("div",[o("v-divider"),o("post-actions",{attrs:{post:t.post,"post-index":t.postIndex},on:{toggleComment:function(e){t.showComment=!t.showComment}}}),o("v-slide-y-transition",[o("div",{directives:[{name:"show",rawName:"v-show",value:t.showComment&&!t.post.disable_comment,expression:"showComment && !post.disable_comment"}]},[t.post.comments.data.length?o("v-divider"):t._e(),t._l(t.post.comments.data,(function(e,i){return o("comment-section",{key:e.id,attrs:{"comment-index":i+1,"comment-instance":e,"post-id":t.post.id,"post-index":t.postIndex},on:{delete:function(e){t.post.comments.data.splice(i,1),t.post.comments.count-=1}}})})),t.post.comments.count>3&&t.post.comments.count>t.post.comments.data.length?o("div",{staticClass:"primaryLight text-caption",attrs:{align:"center"}},[o("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[o("v-btn",t._g({attrs:{"data-cy":1===t.postIndex?"btn-view-more-first":"btn-view-more",block:"",color:"primary",small:"",text:""},domProps:{textContent:t._s("View "+t.formatCount(t.post.comments.count-t.post.comments.data.length)+" More Comments")},on:{click:t.getMoreComments}},i))]}}],null,!1,691992630)},[o("span",[t._v(" "+t._s(t.post.comments.count-t.post.comments.data.length)+" ")])])],1):t._e(),o("v-divider"),o("v-textarea",{staticClass:"my-0 py-1 px-2",attrs:{"data-cy":1===t.postIndex?"input-comment-first":"input-comment",placeholder:t.$t("commentPlaceholder"),rows:1,"hide-details":"","no-resize":"",rounded:""},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.postComment.apply(null,arguments))}},model:{value:t.comment.text,callback:function(e){t.$set(t.comment,"text",e)},expression:"comment.text"}},[o("v-avatar",{attrs:{slot:"prepend",size:"35"},slot:"prepend"},[o("v-img",{attrs:{src:t.getAuthStateUser.user.profile_picture}})],1),o("v-btn",{attrs:{slot:"append","data-cy":1===t.postIndex?"btn-camera-first":"btn-camera",icon:""},on:{click:function(e){return t.$refs.image.click()}},slot:"append"},[o("v-icon",{domProps:{textContent:t._s("mdi-camera")}})],1)],1),o("input",{ref:"image",staticClass:"d-none",attrs:{accept:"image/*",type:"file"},on:{change:t.onFilePicked}}),t.comment.image.file?o("v-divider"):t._e(),t.comment.image.file?o("v-col",[o("v-row",[o("v-img",{attrs:{height:200,src:t.comment.image.url,contain:""}},[o("v-btn",{attrs:{icon:"",small:""},on:{click:function(e){t.comment.image.file=null}}},[o("v-icon",{attrs:{size:"20"},domProps:{textContent:t._s("mdi-close")}})],1)],1)],1)],1):t._e()],2)])],1),o("vue-dialog",{attrs:{notify:t.deleteNotification},on:{agree:t.deleteNotice,close:function(e){t.deleteNotification.dialog=!1}},model:{value:t.deleteNotification.dialog,callback:function(e){t.$set(t.deleteNotification,"dialog",e)},expression:"deleteNotification.dialog"}}),o("vue-dialog",{attrs:{notify:t.unPinNotification},on:{agree:t.unPinNotice,close:function(e){t.unPinNotification.dialog=!1}},model:{value:t.unPinNotification.dialog,callback:function(e){t.$set(t.unPinNotification,"dialog",e)},expression:"unPinNotification.dialog"}}),o("vue-dialog",{attrs:{notify:t.pinNotification},on:{agree:t.pinNotice,close:function(e){t.pinNotification.dialog=!1}},model:{value:t.pinNotification.dialog,callback:function(e){t.$set(t.pinNotification,"dialog",e)},expression:"pinNotification.dialog"}})],1)},n=[],s=o("1da1"),a=o("5530"),r=(o("96cf"),o("a9e3"),o("2ca0"),o("fb6a"),o("ac1f"),o("466d"),o("159b"),o("b64b"),o("a15b"),o("d3b7"),o("1276"),o("498a"),o("99af"),o("9646")),c=o("c44a"),l=o("aaf3"),d=o("0346"),m=o("152f"),p=o("ea98"),u=o("6d1c"),h=o("cf45"),f=o("2f62"),g=o("1467"),v={components:{PostActions:r["a"],CommentSection:l["default"],PostAttachment:d["a"],VueDialog:p["a"],LinkPreview:m["a"],VueTrumbowyg:g["default"]},mixins:[c["a"]],props:{postInstance:{type:Object,required:!0},postIndex:{type:Number,default:0},pinned:{type:Boolean,default:!1}},data:function(){return{post:this.deepCopy(this.postInstance),like:!1,comment:{text:"",image:{url:null,file:null},offset:3},url:"",showComment:!0,deleteNotification:{dialog:!1,heading:"Confirm Delete",text:"Are you sure you want to delete this notice?"},tabsColors:{Pending:"orange",Approved:"green",Denied:"red"},unPinNotification:{dialog:!1,heading:"Confirm Unpin Notice",subheading:"You are about to unpin this notice. Confirm your action.",text:"Are you sure you want to unpin this notice?"},pinNotification:{dialog:!1,heading:"Confirm Pin Notice",subheading:"You are about to pin this notice. Confirm your action.",text:"Are you sure you want to pin this notice?"},editNotice:!1,noticeText:" ",updatePost:{text:"",newImages:{names:[],files:[]},deletedImages:[]},loading:!1,scheduledFor:this.deepCopy(this.postInstance.scheduled_for)}},computed:Object(a["a"])(Object(a["a"])({},Object(f["c"])({getAuthStateUser:"auth/getAuthStateUser",getNoticeBoardNeedApproval:"auth/getNoticeBoardNeedApproval",getNoticeBoardAllowPost:"auth/getNoticeBoardAllowPost",getUserCategory:"organization/getUserCategory",getOrganizationSlug:"organization/getOrganizationSlug"})),{},{postContent:function(){var t=Object(h["f"])("VUE_APP_CLIENT"),e=this.post.post_content;return"laxmi"===t&&e.startsWith("Happy Work Anniversary")?e.slice(0,24):e},postTypes:function(){var t=[{text:"Normal Post",value:"Normal Post"},{text:"Division",value:"Division Notice"},{text:"Condolence Post",value:"Condolence Post"}];return"HR Admin"===this.getUserCategory&&t.push({text:"Organization",value:"Organization Notice"},{text:"HR Notice",value:"HR Notice"}),t},getIsCurrent:function(){return this.post.posted_by.is_current},sameOrganization:function(){return this.post.posted_by.organization_slug===this.getOrganizationSlug},clickableUser:function(){return this.sameOrganization&&this.getIsCurrent},userStatus:function(){return this.sameOrganization?!this.getIsCurrent&&this.sameOrganization?"Past Employee":"":"From Different Organization"},getPostedBy:function(){return"Division Notice"===this.post.category?this.post.posted_by.division:"Organization Notice"===this.post.category?this.post.posted_by.organization:"HR Notice"===this.post.category?"HR Notice":""},getProfilePicture:function(){return this.post.posted_by.profile_picture},isAuthorized:function(){return this.post.posted_by.id===this.getAuthStateUser.user.id||"HR Admin"===this.getUserCategory},getScheduledPostParam:function(){if(this.scheduledFor){var t=this.$dayjs(this.scheduledFor),e=this.$dayjs();return e.diff(t)<0?"?scheduled=True":""}return""},isScheduledPost:function(){return""!==this.getScheduledPostParam}}),created:function(){this.url=this.post.post_content.match(/\bhttps?:\/\/\S+/gi)},methods:Object(a["a"])(Object(a["a"])({},Object(f["d"])({setSnackBar:"common/setSnackBar"})),{},{getClickableLink:h["e"],formatCount:h["c"],viewProfileDetail:function(t){this.$router.push({name:"user-employee-directory-id-profile-detail",params:{id:t}})},updateNotice:function(){var t=this;if(this.loading=!0,this.noticeText){var e=new FormData;if(e.append("post_content",this.noticeText),this.post.pinned&&e.append("pinned",this.post.pinned),this.isScheduledPost&&(e.append("category",this.post.category),e.append("pinned",this.post.pinned),e.append("scheduled_for",this.post.scheduled_for),"Division Notice"===this.post.category&&this.$http.get("/users/"+"".concat(this.getAuthStateUser.user.id)+"/experience/current/").then((function(t){t.division&&e.append("divisions",t.division.slug)})),"Organization Notice"===this.post.category&&e.append("organizations",this.getOrganizationSlug)),this.updatePost.newImages.files.length){var o=this.updatePost.newImages.files.length;Object.keys(this.updatePost.newImages.files).forEach((function(i){e.append("attachment".concat(o-i-1),t.updatePost.newImages.files[o-i-1],t.updatePost.newImages.names[o-i-1])}))}this.updatePost.deletedImages.length&&e.append("deleted_attachments",this.updatePost.deletedImages.join(", ")),this.$http.put(u["a"].patchPost(this.post.id)+this.getScheduledPostParam,e).then((function(e){t.updatePost={text:"",newImages:{names:[],files:[]},deletedImages:[]},t.editNotice=!1,t.post=e,t.setSnackBar({text:"Successfully updated notice",color:"green"})})).catch((function(e){t.notifyInvalidFormResponse(),t.pushErrors(e)})).finally((function(){t.loading=!1}))}else this.notifyUser("Please write something about this post","red")},humanizeDate:function(t){var e=t,o=e.split(" ");return"true"===localStorage.useNepaliDate&&(e=this.bs2ad(t)+" "+o[1]),this.$dayjs(e).diff(this.$dayjs(),"day")<=-7?"true"===localStorage.useNepaliDate?t:this.$dayjs(e).format("YYYY-MM-DD HH:mm A"):this.$dayjs(e).fromNow()},deleteNotice:function(){var t=this;this.$http.delete(u["a"].deletePostById(this.post.id)+this.getScheduledPostParam).then((function(){t.$route.params.id&&t.$router.push({path:"/"}),t.$emit("delete",t.post.id),t.$emit("refresh"),t.setSnackBar({text:"Successfully deleted notice",color:"green"})}))},unPinNotice:function(){var t=this,e=new FormData;e.append("pinned","false"),this.$http.patch(u["a"].patchPost(this.post.id)+this.getScheduledPostParam,e).then((function(){t.$emit("refresh"),t.setSnackBar({text:"Successfully Unpinned notice",color:"green"})}))},pinNotice:function(){var t=this,e=new FormData;e.append("pinned","true"),this.$http.patch(u["a"].patchPost(this.post.id)+this.getScheduledPostParam,e).then((function(){t.$emit("refresh"),t.setSnackBar({text:"Successfully pinned notice",color:"green"})}))},postComment:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=new FormData,!(t.comment.text.length>1e3)){e.next=4;break}return t.notifyUser("The Comment field may not be greater than 1000 characters.","red"),e.abrupt("return");case 4:if(o.append("content",t.comment.text),t.comment.image.file&&o.append("image",t.comment.image.file),!t.comment.text.trim()&&!t.comment.image.file){e.next=14;break}if(!t.loading){e.next=9;break}return e.abrupt("return");case 9:return t.loading=!0,e.next=12,t.$http.post(u["a"].commentPostById(t.post.id),o).then((function(e){t.resetComment(),t.post.comments.count+=1,t.comment.offset+=1,t.post.comments.data.unshift(e)})).catch((function(e){t.notifyUser("Something went wrong.","red"),t.pushErrors(e)})).finally((function(){return t.loading=!1}));case 12:e.next=15;break;case 14:t.notifyUser("Please add a comment","red");case 15:case"end":return e.stop()}}),e)})))()},getMoreComments:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o={offset:t.comment.offset,limit:5},e.next=3,t.$http.get(u["a"].getCommentByPostId(t.post.id),{params:o}).then((function(e){t.post.comments.data=t.post.comments.data.concat(e.results),t.comment.offset+=5}));case 3:case"end":return e.stop()}}),e)})))()},resetComment:function(){this.comment.text="",this.comment.image={url:null,file:null}},humanizedTime:function(t){return this.$dayjs(t).format("YYYY-MM-DD hh:mm:ss")},onFilePicked:function(t){var e=this,o=t.target.files;if(o[0]){var i=new FileReader;i.readAsDataURL(o[0]),i.addEventListener("load",(function(){e.comment.image.url=i.result,e.comment.image.file=o[0]}))}else this.imageName="",this.imageFile=null,this.imageUrl=""}})},y=v,_=(o("3485"),o("2877")),C=o("6544"),b=o.n(C),x=o("8212"),P=o("8336"),k=o("b0af"),w=o("99d9"),N=o("cc20"),I=o("62ad"),S=o("ce7e"),R=o("132d"),V=o("adda"),A=o("8860"),z=o("da13"),D=o("1800"),$=o("8270"),U=o("5d23"),O=o("e449"),L=o("0fd9b"),T=o("b974"),j=o("0789"),B=o("2fa4"),E=o("b73d"),H=o("a844"),M=o("3a2f"),F=Object(_["a"])(y,i,n,!1,null,null,null);e["a"]=F.exports;b()(F,{VAvatar:x["a"],VBtn:P["a"],VCard:k["a"],VCardActions:w["a"],VCardText:w["c"],VChip:N["a"],VCol:I["a"],VDivider:S["a"],VIcon:R["a"],VImg:V["a"],VList:A["a"],VListItem:z["a"],VListItemAction:D["a"],VListItemAvatar:$["a"],VListItemContent:U["a"],VListItemSubtitle:U["b"],VListItemTitle:U["c"],VMenu:O["a"],VRow:L["a"],VSelect:T["a"],VSlideYTransition:j["g"],VSpacer:B["a"],VSwitch:E["a"],VTextarea:H["a"],VTooltip:M["a"]})},aaf3:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("v-list",{staticClass:"py-0",attrs:{color:"primaryLight","three-line":""}},[o("v-list-item",[o("v-list-item-avatar",{staticClass:"my-2"},[o("v-avatar",{attrs:{size:"35"}},[o("v-img",{attrs:{src:t.comment.commented_by.profile_picture}})],1)],1),o("v-list-item-content",[o("v-list-item-title",{staticClass:"my-0"},[t.isCurrent?t.comment.commented_by.organization.slug!=t.getOrganizationSlug?o("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,n=e.attrs;return[o(t.isCurrent&&!t.organizationSpecificDir?"a":"span",t._g(t._b({tag:"component",staticClass:"mr-2",domProps:{textContent:t._s(t.comment.commented_by.full_name)},on:{click:function(e){!t.organizationSpecificDir&&t.isCurrent&&t.viewProfileDetail(t.comment.commented_by.id)}}},"component",n,!1),i))]}}])},[o("span",[t._v("From Different Organization")])]):o("a",{staticClass:"mr-2",domProps:{textContent:t._s(t.comment.commented_by.full_name)},on:{click:function(e){return t.viewProfileDetail(t.comment.commented_by.id)}}}):o("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on,n=e.attrs;return[o("span",t._g(t._b({staticClass:"mr-2"},"span",n,!1),i),[t._v(t._s(t.comment.commented_by.full_name))])]}}],null,!1,2534926288)},[o("span",[t._v("Past Employee")])]),o("span",{staticClass:"text-caption grey--text",domProps:{textContent:t._s(t.humanizeDate(t.comment.created_at))}}),t.humanizedTime(t.comment.created_at)!==t.humanizedTime(t.comment.modified_at)?o("span",{staticClass:"text-caption grey--text",domProps:{textContent:t._s(" - Edited")}}):t._e()],1),o("v-list-item-subtitle",{staticClass:"py-1",staticStyle:{"-webkit-line-clamp":"unset"}},[t.editComment?o("div",[o("v-text-field",{staticClass:"my-0 pt-0",attrs:{"append-icon":t.isReply?"":"mdi-camera"},on:{"click:append":function(e){return t.$refs.updateImage.click()}},model:{value:t.update.text,callback:function(e){t.$set(t.update,"text",e)},expression:"update.text"}}),o("input",{ref:"updateImage",staticClass:"d-none",attrs:{type:"file",accept:"image/*"},on:{change:t.addCommentImage}}),t.update.image.url?o("v-img",{attrs:{height:150,width:150,src:t.update.image.url}},[o("v-icon",{staticClass:"float-right",attrs:{color:"danger"},domProps:{textContent:t._s("mdi-close")},on:{click:function(e){t.update.image.url=null}}})],1):t._e()],1):o("div",{attrs:{"data-cy":1===t.postIndex&&1===t.commentIndex?"post-comment-first":"post-comment"}},[o("span",{domProps:{innerHTML:t._s(t.$sanitize(t.getUserComment))}}),o("span",[t.comment.content.length>100?o("a",{style:t.showMoreComment?"visibility: hidden":"visibility: visible",on:{click:function(e){t.showMoreComment=!t.showMoreComment}}},[t._v("Read more")]):t._e()])])]),t.comment.image&&!t.editComment?o("v-list-item-subtitle",{staticClass:"my-1 pointer"},[o("v-img",{attrs:{height:150,width:150,src:t.comment.image},on:{click:function(e){t.attachments=[t.comment],t.showImageViewer=!0}}})],1):t._e(),t.editComment?o("div",{staticClass:"my-2",attrs:{align:"start"}},[o("v-btn",{attrs:{disabled:t.update.text===t.comment.content&&t.update.image.url===t.comment.image,small:"",depressed:"",color:"primary"},domProps:{textContent:t._s("Save")},on:{click:function(e){t.isReply?t.updateReply():t.updateComment()}}}),o("v-btn",{staticClass:"ml-2",attrs:{outlined:"",small:""},domProps:{textContent:t._s("Cancel")},on:{click:function(e){t.editComment=!1}}})],1):t._e(),t.editComment?t._e():o("div",[t.isReply?t._e():o("span",{class:(t.liked?"primary":"grey")+"--text text-caption"},[o("v-btn",{attrs:{"data-cy":1===t.postIndex&&1===t.commentIndex?"btn-comment-like-first":"btn-comment-like",icon:"",small:""},on:{click:t.likeComment}},[o("v-icon",{attrs:{color:t.liked?"primary":"grey",size:12},domProps:{textContent:t._s("mdi-thumb-up")}})],1),o("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[t.likesCount>0?o("span",t._g({staticClass:"text-caption pointer",domProps:{textContent:t._s(t.formatCount(t.likesCount))},on:{click:function(e){t.displayLikers=!0}}},i)):t._e()]}}],null,!1,2727986913)},[o("span",[t._v(" "+t._s(t.likesCount)+" ")])])],1),t.isReply?t._e():o("span",{staticClass:"ml-3"},[o("v-btn",{attrs:{"data-cy":1===t.postIndex&&1===t.commentIndex?"btn-toggle-reply-first":"btn-toggle-reply",icon:"",small:""},on:{click:t.toggleReply}},[o("v-icon",{attrs:{color:"grey",size:"15"},domProps:{textContent:t._s("mdi-reply")}})],1),o("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[t.repliesCount>0?o("span",t._g({staticClass:"text-caption grey--text",domProps:{textContent:t._s(t.formatCount(t.repliesCount))}},i)):t._e()]}}],null,!1,1269899933)},[o("span",[t._v(" "+t._s(t.repliesCount)+" ")])])],1)]),t.showReply&&!t.isReply?o("v-row",[t.replies.length?o("v-divider",{attrs:{vertical:""}}):t._e(),o("v-col",[t.loadingReply&&!t.replies.length?o("v-progress-linear",{attrs:{height:2,indeterminate:""}}):t._e(),t.repliesCount?o("span",[t._l(t.replies,(function(e,i){return o("comment-section",{key:e.id,attrs:{"post-id":t.postId,"comment-id":t.comment.id,"is-reply":!0,"comment-instance":t.prepareReply(e)},on:{delete:function(e){t.replies.splice(i,1),t.repliesCount-=1,t.offset-=1}}})})),t.repliesCount>3&&t.repliesCount>t.replies.length?o("div",{attrs:{align:"center"}},[o("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[o("a",t._g({domProps:{textContent:t._s("View "+t.formatCount(t.repliesCount-t.replies.length)+" More Replies")},on:{click:t.getReplies}},i))]}}],null,!1,1274894366)},[o("span",[t._v(" "+t._s(t.repliesCount-t.replies.length)+" ")])])],1):t._e()],2):t._e(),t.isReply?t._e():o("v-textarea",{staticClass:"my-0 py-1 px-2",attrs:{rows:1,"data-cy":1===t.postIndex&&1===t.commentIndex?"input-reply-first":"input-reply",placeholder:"Post a reply","hide-details":"","no-resize":""},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.postReply.apply(null,arguments))}},model:{value:t.reply,callback:function(e){t.reply=e},expression:"reply"}},[o("v-avatar",{attrs:{slot:"prepend",size:"35"},slot:"prepend"},[o("v-img",{attrs:{src:t.getAuthStateUser.user.profile_picture}})],1)],1)],1)],1):t._e()],1),o("v-list-item-action",[!t.editComment&&t.isAuthorized?o("v-menu",{attrs:{bottom:"",right:""},scopedSlots:t._u([{key:"activator",fn:function(e){var i=e.on;return[o("v-icon",t._g({attrs:{"data-cy":1===t.postIndex&&1===t.commentIndex?"reply-dropdown-menu-first":"reply-dropdown-menu",small:""},domProps:{textContent:t._s("mdi-menu-down")}},i))]}}],null,!1,1944738727)},[o("v-list",{attrs:{dense:""}},[t.comment.commented_by.id===t.userDetail.user.id?o("v-list-item",{attrs:{"data-cy":1===t.postIndex&&1===t.commentIndex?"reply-dropdown-menu-item-first":"reply-dropdown-menu-item"},on:{click:function(e){t.update.text=t.comment.content,t.editComment=!0,t.update.image.url=t.comment.image}}},[o("v-list-item-title",[o("v-icon",{attrs:{small:""},domProps:{textContent:t._s("mdi-pencil")}}),o("span",{domProps:{textContent:t._s("Update "+(t.isReply?"Reply":"Comment"))}})],1)],1):t._e(),o("v-list-item",{attrs:{"data-cy":1===t.postIndex&&1===t.commentIndex?"reply-dropdown-menu-item-first":"reply-dropdown-menu-item"},on:{click:function(e){t.deleteNotification.dialog=!0}}},[o("v-list-item-title",[o("v-icon",{attrs:{small:""},domProps:{textContent:t._s("mdi-delete")}}),o("span",{domProps:{textContent:t._s("Delete "+(t.isReply?"Reply":"Comment"))}})],1)],1)],1)],1):t._e()],1)],1)],1),o("vue-dialog",{attrs:{notify:t.deleteNotification},on:{close:function(e){t.deleteNotification.dialog=!1},agree:function(e){t.isReply?t.deleteReply():t.deleteComment()}}}),o("user-list-dialog",{attrs:{endpoint:t.userEndpoint,title:"People who liked this comment"},on:{close:function(e){t.displayLikers=!1}},model:{value:t.displayLikers,callback:function(e){t.displayLikers=e},expression:"displayLikers"}}),t.showImageViewer?o("image-viewer",{attrs:{items:t.attachments},on:{close:function(e){t.showImageViewer=!1}}}):t._e()],1)},n=[],s=o("5530"),a=(o("d3b7"),o("3ca3"),o("ddb0"),o("a9e3"),o("99af"),o("b0c0"),o("498a"),o("2f62")),r=o("9815"),c=o("ea98"),l=o("8448"),d=o("6d1c"),m=o("c44a"),p=o("cf45"),u=o("a78e"),h={name:"Comments",components:{CommentSection:function(){return Promise.resolve().then(o.bind(null,"aaf3"))},VueDialog:c["a"],UserListDialog:r["default"],ImageViewer:l["a"]},mixins:[m["a"],m["a"]],props:{commentInstance:{type:Object,required:!0},postId:{type:[Number,String],required:!0},postIndex:{type:Number,default:0},commentIndex:{type:Number,default:0},commentId:{type:[Number,String],default:void 0},isReply:{type:Boolean,default:!1}},data:function(){return{comment:this.deepCopy(this.commentInstance),liked:!1,likesCount:0,repliesCount:0,replies:[],showReply:!1,reply:"",offset:0,sending:!1,loadingReply:!1,editComment:!1,update:{text:null,image:{url:"",file:""}},displayLikers:!1,deleteNotification:{dialog:!1,heading:"Confirm Delete",text:"Are you sure you want to delete this ".concat(this.isReply?"reply?":"comment?")},userEndpoint:"",showImageViewer:!1,attachments:[],showMoreComment:!1}},computed:Object(s["a"])(Object(s["a"])({},Object(a["c"])({userDetail:"auth/userDetail",getAuthStateUser:"auth/getAuthStateUser",getUserCategory:"organization/getUserCategory",getOrganizationSlug:"organization/getOrganizationSlug"})),{},{isCurrent:function(){return this.comment.commented_by.is_current},organizationSpecificDir:function(){return u.get("organizationSpecificDir")},isAuthorized:function(){return this.comment.commented_by.id===this.getAuthStateUser.user.id||"HR Admin"===this.getUserCategory},getUserComment:function(){return this.comment.content.length>100&&!this.showMoreComment?this.comment.content.substring(0,100)+"   ":this.getClickableLink(this.comment.content)}}),created:function(){this.liked=this.comment.liked_by_user,this.likesCount=this.comment.likes_count,this.repliesCount=this.comment.replies_count,this.userEndpoint=d["a"].getLikedCommentById(this.comment.id)},methods:Object(s["a"])(Object(s["a"])({},Object(a["d"])({setSnackBar:"common/setSnackBar"})),{},{getClickableLink:p["e"],formatCount:p["c"],humanizedTime:function(t){return this.$dayjs(t).format("YYYY-MM-DD hh:mm:ss")},viewProfileDetail:function(t){this.$router.push({name:"user-employee-directory-id-profile-detail",params:{id:t}})},updateComment:function(){var t=this;if(!this.sending)if(this.update.text){var e="/noticeboard/post/comment/".concat(this.postId,"/").concat(this.comment.id,"/");if(this.update.image.url){var o=new FormData;o.append("content",this.update.text),this.update.image.file&&o.append("image",this.update.image.file,this.update.image.file.name),this.$http.patch(e,o).then((function(e){t.sending=!0,t.editComment=!1,t.showReply=!1,t.comment=e})).finally((function(){return t.sending=!1}))}else{var i={content:this.update.text,image:null};this.$http.put(e,i).then((function(e){t.editComment=!1,t.showReply=!1,t.comment=e}))}}else this.notifyUser("Please add a comment","red")},addCommentImage:function(t){var e=this,o=t.target.files;if(o[0]){var i=new FileReader;i.readAsDataURL(o[0]),i.addEventListener("load",(function(){e.update.image={file:o[0],url:i.result}}))}},deleteComment:function(){var t=this,e="/noticeboard/post/comment/".concat(this.postId,"/").concat(this.comment.id,"/");this.$http.delete(e).then((function(){t.setSnackBar({text:"Successfully deleted comment",color:"green"}),t.$emit("delete")}))},likeComment:function(){var t=this;this.liked?this.likesCount-=1:this.likesCount+=1,this.liked=!this.liked;var e="/noticeboard/post/comment/like/"+this.comment.id+"/";this.$http.post(e,{liked:this.liked}).catch((function(){t.liked=!t.liked,t.liked?t.likesCount+=1:t.likesCount-=1}))},toggleReply:function(){this.showReply=!this.showReply,this.showReply&&this.getReplies()},getReplies:function(){var t=this;this.loadingReply=!0;var e={offset:this.offset,limit:3},o="/noticeboard/post/comment/reply/".concat(this.comment.id,"/");this.$http.get(o,{params:e}).then((function(e){t.replies=t.replies.concat(e.results),t.loadingReply=!1,t.offset+=3}))},postReply:function(){var t=this;if(!this.sending)if(this.sending=!0,this.reply.trim()){if(this.reply.length>1e3)return void this.notifyUser("The Reply field may not be greater than 1000 characters.","red");var e="/noticeboard/post/comment/reply/".concat(this.comment.id,"/");this.$http.post(e,{reply:this.reply}).then((function(e){t.replies.unshift(t.prepareReply(e)),t.reply="",t.repliesCount+=1})).finally((function(){t.sending=!1}))}else this.notifyUser("Please add a reply.","red")},updateReply:function(){var t=this,e="/noticeboard/post/comment/reply/".concat(this.commentId,"/").concat(this.comment.id,"/");this.$http.put(e,{reply:this.update.text}).then((function(e){t.comment=t.prepareReply(e),t.editComment=!1,t.setSnackBar({text:"Successfully updated reply.",color:"green"})}))},deleteReply:function(){var t=this,e="/noticeboard/post/comment/reply/".concat(this.commentId,"/").concat(this.comment.id,"/");this.$http.delete(e).then((function(){t.$emit("delete"),t.setSnackBar({text:"Successfully deleted reply",color:"green"})}))},prepareReply:function(t){return Object(s["a"])(Object(s["a"])({},t),{},{content:t.reply,commented_by:t.reply_by})}})},f=h,g=o("2877"),v=o("6544"),y=o.n(v),_=o("8212"),C=o("8336"),b=o("62ad"),x=o("ce7e"),P=o("132d"),k=o("adda"),w=o("8860"),N=o("da13"),I=o("1800"),S=o("8270"),R=o("5d23"),V=o("e449"),A=o("8e36"),z=o("0fd9b"),D=o("8654"),$=o("a844"),U=o("3a2f"),O=Object(g["a"])(f,i,n,!1,null,null,null);e["default"]=O.exports;y()(O,{VAvatar:_["a"],VBtn:C["a"],VCol:b["a"],VDivider:x["a"],VIcon:P["a"],VImg:k["a"],VList:w["a"],VListItem:N["a"],VListItemAction:I["a"],VListItemAvatar:S["a"],VListItemContent:R["a"],VListItemSubtitle:R["b"],VListItemTitle:R["c"],VMenu:V["a"],VProgressLinear:A["a"],VRow:z["a"],VTextField:D["a"],VTextarea:$["a"],VTooltip:U["a"]})}}]);